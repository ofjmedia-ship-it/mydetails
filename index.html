<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Executive Productivity Suite</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f4f6f9;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    header {
      background-color: #1a3c6d;
      color: #fff;
      padding: 20px;
      border-radius: 8px 8px 0 0;
      position: relative;
    }
    header h1 {
      margin: 0;
      font-size: 26px;
    }
    header p {
      margin: 5px 0 0;
      font-size: 14px;
    }
    .secret-button {
      opacity: 0.4;
      background: none;
      border: none;
      cursor: pointer;
      position: absolute;
      top: 20px;
      width: 24px;
      height: 24px;
      transition: opacity 0.3s;
    }
    .secret-button:hover {
      opacity: 0.9;
    }
    #add-secret-button { left: 20px; }
    #view-secret-button { right: 20px; }
    .section {
      padding: 20px;
      border-bottom: 1px solid #e0e0e0;
    }
    .section:last-child {
      border-bottom: none;
    }
    h2 {
      font-size: 20px;
      margin-bottom: 15px;
      color: #1a3c6d;
    }
    input, textarea, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      background-color: #1a3c6d;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #153058;
    }
    .error {
      color: #d32f2f;
      font-size: 14px;
      margin-top: 8px;
    }
    .success {
      color: #2e7d32;
      font-size: 14px;
      margin-top: 8px;
    }
    .todo-list .task {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .todo-list select {
      margin-left: 10px;
      padding: 5px;
      border-radius: 4px;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      text-align: center;
    }
    .calendar div {
      padding: 10px;
      background-color: #f9f9f9;
      border: 1px solid #e0e0e0;
    }
    .calendar .header {
      background-color: #1a3c6d;
      color: #fff;
      font-weight: bold;
    }
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
    }
    .gallery img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 4px;
    }
    .game-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    .card {
      width: 80px;
      height: 80px;
      background-color: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.3s;
    }
    .card.flipped {
      transform: rotateY(180deg);
    }
    .card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      backface-visibility: hidden;
    }
    .ticker {
      background-color: #f0f0f0;
      padding: 10px;
      white-space: nowrap;
      overflow: hidden;
      box-sizing: border-box;
    }
    .ticker span {
      display: inline-block;
      padding-left: 100%;
      animation: ticker 15s linear infinite;
    }
    @keyframes ticker {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }
    .data-processor div {
      margin-bottom: 10px;
    }
    .data-processor input[type="radio"] {
      margin-right: 5px;
    }
    .hidden {
      display: none;
    }
    @media (max-width: 600px) {
      .container {
        margin: 10px;
      }
      .game-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      .card {
        width: 60px;
        height: 60px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Executive Productivity Suite</h1>
      <p>Streamline your workflow with advanced organization tools</p>
      <button id="add-secret-button" class="secret-button" title="Add Data"><svg xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24"><path d="M19.14 12.94a7 7 0 1 1-14-2 7 7 0 0 1 14 2zM15 12a3 3 0 1 0-6 0 3 3 0 0 0 6 0zm-9 8a9 9 0 0 1 18 0v1H6v-1z"/></svg></button>
      <button id="view-secret-button" class="secret-button" title="View Data"><svg xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5C21.27 7.61 17 4.5 12 4.5zm0 12.5c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg></button>
    </header>

    <!-- Add Data Form (Hidden) -->
    <div id="add-form" class="section hidden">
      <h2>Add Secure Data</h2>
      <div>
        <label class="block font-medium">GitHub Personal Access Token (Enter once)</label>
        <input id="github-pat" type="password" placeholder="Enter PAT (e.g., github_pat_...)">
        <button id="save-pat">Save PAT</button>
      </div>
      <div>
        <label class="block font-medium">Name of Platform</label>
        <input id="platform-input" type="text" placeholder="e.g., Gmail">
      </div>
      <div>
        <label class="block font-medium">Email</label>
        <input id="email-input" type="email" placeholder="e.g., user@gmail.com">
      </div>
      <div>
        <label class="block font-medium">Key</label>
        <input id="key-input" type="text" placeholder="Enter encrypted key">
      </div>
      <button id="add-button">Add Data</button>
      <button id="clear-storage" class="bg-red-600 hover:bg-red-700">Clear All Data</button>
      <p id="add-error" class="error"></p>
      <p id="add-success" class="success"></p>
    </div>

    <!-- View Data (Hidden) -->
    <div id="view-data" class="section hidden">
      <h2>Stored Data</h2>
      <div id="data-list" class="space-y-2 mt-4"></div>
      <p id="view-error" class="error"></p>
    </div>

    <!-- To-Do List -->
    <div class="section">
      <h2>Task Manager</h2>
      <div class="todo-list">
        <div class="task"><input type="checkbox"><span>Prepare quarterly report</span><select><option>High</option><option>Medium</option><option>Low</option></select></div>
        <div class="task"><input type="checkbox"><span>Schedule client call</span><select><option>High</option><option>Medium</option><option>Low</option></select></div>
        <div class="task"><input type="text" placeholder="Add new task..." id="new-task-input"><button id="add-task">Add</button></div>
      </div>
    </div>

    <!-- Calendar -->
    <div class="section">
      <h2>Monthly Schedule</h2>
      <div class="calendar">
        <div class="header">Sun</div><div class="header">Mon</div><div class="header">Tue</div><div class="header">Wed</div><div class="header">Thu</div><div class="header">Fri</div><div class="header">Sat</div>
        <div></div><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div>
        <div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div>
        <div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div>
        <div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div>
        <div>28</div><div>29</div><div>30</div><div></div><div></div><div></div><div></div>
      </div>
    </div>

    <!-- Weather Widget -->
    <div class="section">
      <h2>Weather Outlook</h2>
      <input type="text" placeholder="Enter city (e.g., Lagos)" id="weather-city">
      <div id="weather-output" class="mt-2">Lagos: 28Â°C, Partly Cloudy</div>
    </div>

    <!-- Notes -->
    <div class="section">
      <h2>Quick Notes</h2>
      <textarea rows="4" placeholder="Capture your ideas..." id="notes"></textarea>
      <button id="save-notes">Save Notes</button>
    </div>

    <!-- Quote Rotator -->
    <div class="section">
      <h2>Daily Inspiration</h2>
      <p id="quote" class="italic"></p>
    </div>

    <!-- News Ticker -->
    <div class="section ticker">
      <span>Productivity Tip: Break tasks into smaller steps to stay focused!</span>
    </div>

    <!-- Image Gallery -->
    <div class="section">
      <h2>Visual Inspiration</h2>
      <div class="gallery">
        <img src="https://images.unsplash.com/photo-14973662105479-4275897d0059" alt="Office">
        <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e" alt="Beach">
        <img src="https://images.unsplash.com/photo-1519681393784-d120267933ba" alt="Mountain">
        <img src="https://images.unsplash.com/photo-1472214103451-9374bd1c798e" alt="Forest">
        <img src="https://images.unsplash.com/photo-1506748686214-e9df14d4d9d0" alt="City">
      </div>
    </div>

    <!-- Memory Game -->
    <div class="section">
      <h2>Memory Challenge</h2>
      <div id="game" class="game-grid"></div>
      <p id="game-message" class="text-center mt-4"></p>
    </div>

    <!-- Data Processor -->
    <div class="section data-processor">
      <h2>Data Processor</h2>
      <div>
        <label class="block font-medium">Input Data</label>
        <input type="password" id="data-input" placeholder="Enter data">
      </div>
      <div>
        <label class="block font-medium">Password</label>
        <input type="password" id="data-key-input" placeholder="Enter password for encryption">
      </div>
      <div>
        <label class="block font-medium">Output</label>
        <textarea id="data-output" rows="4" placeholder="Processed result"></textarea>
      </div>
      <div>
        <input type="radio" id="process" name="mode" value="process" checked>
        <label for="process">Encrypt</label>
        <input type="radio" id="reverse" name="mode" value="reverse">
        <label for="reverse">Decrypt</label>
      </div>
      <button onclick="handleProcess()">Execute</button>
      <p id="process-error" class="error"></p>
    </div>
  </div>

  <script>
    // Encryption utilities
    async function deriveKey(password, salt) {
      const enc = new TextEncoder();
      const keyMaterial = await crypto.subtle.importKey(
        "raw",
        enc.encode(password),
        { name: "PBKDF2" },
        false,
        ["deriveBits", "deriveKey"]
      );
      return await crypto.subtle.deriveKey(
        {
          name: "PBKDF2",
          salt: salt || crypto.getRandomValues(new Uint8Array(16)),
          iterations: 100000,
          hash: "SHA-256"
        },
        keyMaterial,
        { name: "AES-GCM", length: 256 },
        true,
        ["encrypt", "decrypt"]
      );
    }

    async function encryptData(data, password) {
      const enc = new TextEncoder();
      const salt = crypto.getRandomValues(new Uint8Array(16));
      const key = await deriveKey(password, salt);
      const iv = crypto.getRandomValues(new Uint8Array(12));
      const encrypted = await crypto.subtle.encrypt(
        { name: "AES-GCM", iv },
        key,
        enc.encode(data)
      );
      const combined = new Uint8Array(salt.length + iv.length + encrypted.byteLength);
      combined.set(salt, 0);
      combined.set(iv, salt.length);
      combined.set(new Uint8Array(encrypted), salt.length + iv.length);
      return btoa(String.fromCharCode(...combined));
    }

    async function decryptData(encryptedBase64, password) {
      const dec = new TextDecoder();
      try {
        const combined = Uint8Array.from(atob(encryptedBase64), c => c.charCodeAt(0));
        const salt = combined.slice(0, 16);
        const iv = combined.slice(16, 28);
        const encrypted = combined.slice(28);
        const key = await deriveKey(password, salt);
        const decrypted = await crypto.subtle.decrypt(
          { name: "AES-GCM", iv },
          key,
          encrypted
        );
        return dec.decode(decrypted);
      } catch (e) {
        throw new Error("Decryption failed: Invalid password or data");
      }
    }

    // GitHub API utilities
    async function checkRateLimit(pat) {
      try {
        const response = await fetch('https://api.github.com/rate_limit', {
          headers: {
            Authorization: `token ${pat}`,
            'Accept': 'application/vnd.github.v3+json',
            'User-Agent': 'Password-Vault-App'
          }
        });
        if (!response.ok) throw new Error(`Rate limit check failed: HTTP ${response.status}`);
        const data = await response.json();
        if (data.rate.remaining === 0) {
          const resetTime = new Date(data.rate.reset * 1000).toLocaleString();
          throw new Error(`API rate limit exceeded. Try again after ${resetTime}`);
        }
        return data.rate;
      } catch (e) {
        throw new Error(`Rate limit check error: ${e.message}`);
      }
    }

    async function getGitHubFile(pat) {
      for (let attempt = 1; attempt <= 3; attempt++) {
        try {
          await checkRateLimit(pat); // Check rate limit before fetching
          const response = await fetch('https://api.github.com/repos/ofjmedia-ship-it/password-vault/contents/data.json', {
            headers: {
              Authorization: `token ${pat}`,
              'Accept': 'application/vnd.github.v3+json',
              'User-Agent': 'Password-Vault-App'
            }
          });
          if (response.status === 401) throw new Error('Invalid PAT: Unauthorized access');
          if (response.status === 404) throw new Error('data.json not found in repository');
          if (response.status === 403) throw new Error('API rate limit exceeded or PAT lacks repo scope');
          if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          const data = await response.json();
          return { content: JSON.parse(atob(data.content)), sha: data.sha };
        } catch (e) {
          if (attempt === 3) throw new Error(`Failed to fetch data.json after 3 attempts: ${e.message}`);
          await new Promise(resolve => setTimeout(resolve, 2000 * attempt));
        }
      }
    }

    async function updateGitHubFile(pat, content, sha) {
      for (let attempt = 1; attempt <= 3; attempt++) {
        try {
          await checkRateLimit(pat); // Check rate limit before updating
          console.log(`Updating data.json - Attempt ${attempt} at ${new Date().toISOString()}`);
          const response = await fetch('https://api.github.com/repos/ofjmedia-ship-it/password-vault/contents/data.json', {
            method: 'PUT',
            headers: {
              Authorization: `token ${pat}`,
              'Accept': 'application/vnd.github.v3+json',
              'Content-Type': 'application/json',
              'User-Agent': 'Password-Vault-App'
            },
            body: JSON.stringify({
              message: `Update data.json at ${new Date().toISOString()}`,
              content: btoa(JSON.stringify(content, null, 2)),
              sha
            })
          });
          if (response.status === 401) throw new Error('Invalid PAT: Unauthorized access');
          if (response.status === 404) throw new Error('data.json not found in repository');
          if (response.status === 409) throw new Error('SHA mismatch: File was modified elsewhere');
          if (response.status === 403) throw new Error('API rate limit exceeded or PAT lacks repo scope');
          if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          return await response.json();
        } catch (e) {
          if (attempt === 3) throw new Error(`Failed to update data.json after 3 attempts: ${e.message}`);
          await new Promise(resolve => setTimeout(resolve, 2000 * attempt));
        }
      }
    }

    // Save PAT
    document.getElementById('save-pat').addEventListener('click', async () => {
      const pat = document.getElementById('github-pat').value.trim();
      const error = document.getElementById('add-error');
      const success = document.getElementById('add-success');
      if (!pat) {
        error.textContent = 'GitHub PAT is required!';
        success.textContent = '';
        return;
      }
      try {
        await getGitHubFile(pat); // Test PAT
        localStorage.setItem('githubPAT', pat);
        success.textContent = 'PAT saved successfully! You can now add and view data.';
        error.textContent = '';
        document.getElementById('github-pat').value = '';
        setTimeout(() => {
          success.textContent = '';
          error.textContent = '';
        }, 5000);
        loadData();
      } catch (e) {
        error.textContent = `Error: Invalid PAT or repository setup - ${e.message}`;
        success.textContent = '';
      }
    });

    // Secret button handlers
    document.getElementById('add-secret-button').addEventListener('click', () => {
      document.getElementById('add-form').classList.toggle('hidden');
      document.getElementById('view-data').classList.add('hidden');
    });

    document.getElementById('view-secret-button').addEventListener('click', () => {
      document.getElementById('view-data').classList.toggle('hidden');
      document.getElementById('add-form').classList.add('hidden');
      loadData();
    });

    // Add data
    document.getElementById('add-button').addEventListener('click', async () => {
      const pat = localStorage.getItem('githubPAT');
      const platform = document.getElementById('platform-input').value.trim();
      const email = document.getElementById('email-input').value.trim();
      const key = document.getElementById('key-input').value.trim();
      const error = document.getElementById('add-error');
      const success = document.getElementById('add-success');

      if (!pat) {
        error.textContent = 'Please save your GitHub PAT first!';
        success.textContent = '';
        return;
      }
      if (!platform || !email || !key) {
        error.textContent = 'All fields are required!';
        success.textContent = '';
        return;
      }

      try {
        const { content, sha } = await getGitHubFile(pat);
        content.accounts.push({ platform, email, key });
        await updateGitHubFile(pat, content, sha);
        document.getElementById('platform-input').value = '';
        document.getElementById('email-input').value = '';
        document.getElementById('key-input').value = '';
        success.textContent = 'Data added successfully!';
        error.textContent = '';
        setTimeout(() => {
          success.textContent = '';
          error.textContent = '';
        }, 5000);
        loadData();
      } catch (e) {
        error.textContent = `Error: ${e.message}`;
        success.textContent = '';
      }
    });

    // Clear data
    document.getElementById('clear-storage').addEventListener('click', async () => {
      const pat = localStorage.getItem('githubPAT');
      const error = document.getElementById('add-error');
      const success = document.getElementById('add-success');
      if (!pat) {
        error.textContent = 'Please save your GitHub PAT first!';
        success.textContent = '';
        return;
      }
      if (!confirm('Are you sure you want to clear all stored data?')) return;
      try {
        const { sha } = await getGitHubFile(pat);
        await updateGitHubFile(pat, { accounts: [] }, sha);
        success.textContent = 'All data cleared successfully!';
        error.textContent = '';
        setTimeout(() => {
          success.textContent = '';
          error.textContent = '';
        }, 5000);
        loadData();
      } catch (e) {
        error.textContent = `Error: ${e.message}`;
        success.textContent = '';
      }
    });

    // Load and display data
    async function loadData() {
      const pat = localStorage.getItem('githubPAT');
      const dataList = document.getElementById('data-list');
      const error = document.getElementById('view-error');
      if (!pat) {
        error.textContent = 'Please save your GitHub PAT in the Add Data section!';
        dataList.innerHTML = '<p>No data stored yet.</p>';
        return;
      }
      try {
        const { content } = await getGitHubFile(pat);
        dataList.innerHTML = '';
        if (content.accounts.length === 0) {
          dataList.innerHTML = '<p>No data stored yet.</p>';
          return;
        }
        content.accounts.forEach((item, index) => {
          const div = document.createElement('div');
          div.className = 'p-2 border-b flex justify-between items-center';
          div.innerHTML = `
            <span><strong>${item.platform}</strong> | Email: ${item.email} | Key: ${item.key}</span>
            <button class="delete-btn bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700" data-index="${index}">Delete</button>
          `;
          dataList.appendChild(div);
        });
        document.querySelectorAll('.delete-btn').forEach(btn => {
          btn.addEventListener('click', async () => {
            const index = parseInt(btn.getAttribute('data-index'));
            if (!confirm(`Delete ${content.accounts[index].platform} entry?`)) return;
            try {
              const { content: latestContent, sha } = await getGitHubFile(pat);
              latestContent.accounts.splice(index, 1);
              await updateGitHubFile(pat, latestContent, sha);
              document.getElementById('add-success').textContent = 'Entry deleted successfully!';
              document.getElementById('add-error').textContent = '';
              setTimeout(() => {
                document.getElementById('add-success').textContent = '';
                document.getElementById('add-error').textContent = '';
              }, 5000);
              loadData();
            } catch (e) {
              error.textContent = `Error deleting entry: ${e.message}`;
            }
          });
        });
        error.textContent = '';
      } catch (e) {
        error.textContent = `Error: ${e.message}`;
        dataList.innerHTML = '<p>Failed to load data.</p>';
      }
    }

    // Data Processor
    async function handleProcess() {
      const dataInput = document.getElementById('data-input').value;
      const password = document.getElement
